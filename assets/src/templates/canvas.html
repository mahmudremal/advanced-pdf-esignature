
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Demo Canvas 015</title>
  <link href="css/normalize.css" rel="stylesheet" />
  <link href="css/tests.css" rel="stylesheet" />
</head>

<body>
  <h1><a href="index.html">Scrawl-canvas v8</a> - Canvas test 015</h1>
  <h2>Phrase entity (make, clone, method, multiline)</h2>

  <canvas 
    id="mycanvas" 
    width="650" 
    height="300"
    data-scrawl-canvas
    data-base-background-color="aliceblue"
  ></canvas>

  <p id="reportmessage"></p>

  <div class="testinfo">
    <h4>Test purpose</h4>
    <ul>
      <li>Create a phrase entity</li>
      <li>Clone a phrase</li>
      <li>Position the phrase on the canvas</li>
      <li>Change the state of a subset of phrases sharing the same state object</li>
      <li>Check the various drawing methods available to the phrase</li>
    </ul>
    <ul>
      <li>Kill and resurrect several entitys to make sure they remove themselves entirely from the Scrawl-canvas system, and cleanly recreate themselves from saved packets</li>
    </ul>

    <p><b>Note 1:</b> this Demo will appear differently on webkit-based (for example: Safari) and other browsers because webkit engines have difficulty understanding font strings that include a bold keyword. To achieve boldness in these browsers, use a font face that already has boldness applied to it.</p>

    <p><b>Note 2: <i>known Firefox issue - demo render speeds will severely degrade when applying shadows (in particular: shadowBlur) to canvas text</i></b>. See the following Bugzilla issues <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=527386">527386 Canvas text functions are too slow</a> (opened in 2009) and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1579513">1579513 Drawing text in Canvas 2D is slow</a> (opened in 2019).</p>
    
    <p><b>Touch test:</b> should work as expected - though flicking a text may lead to it moving beyond the canvas border and out of sight!</p>

    <p><a href="../docs/demo/canvas-015.html">Annotated code</a></p>
  </div>
    <script type="module">
        import * as scrawl from "https://unpkg.com/scrawl-canvas@8.12.0";
    </script>
<script>

const L = scrawl.library
// #### Scene setup
// Get a handle to the Canvas wrapper
const canvas = L.artefact.mycanvas;


// Namespacing boilerplate
const namespace = 'demo';
const name = (n) => `${namespace}-${n}`;


// Create and clone Phrase entitys
makePhrase({
    name: name('myphrase_fill'),

    text: 'H&epsilon;lj&ouml;!',
    font: 'bold 40px Garamond, serif',

    startX: '14%',
    startY: '28%',
    handleX: 'center',
    handleY: 'center',

    fillStyle: 'green',
    strokeStyle: 'gold',

    lineWidth: 2,
    lineJoin: 'round',
    shadowOffsetX: 2,
    shadowOffsetY: 2,
    shadowBlur: 2,
    shadowColor: 'black',

    showBoundingBox: true,
    boundingBoxColor: 'red',

}).clone({
    name: name('myphrase_draw'),
    startX: '38%',
    method: 'draw',

}).clone({
    name: name('myphrase_drawAndFill'),
    startX: '84%',
    method: 'drawAndFill',

}).clone({
    name: name('myphrase_fillAndDraw'),
    startX: '62%',
    method: 'fillAndDraw',
    sharedState: true

}).clone({
    name: name('myphrase_drawThenFill'),
    startX: '14%',
    startY: '67%',
    method: 'drawThenFill'

}).clone({
    name: name('myphrase_fillThenDraw'),
    startX: '38%',
    method: 'fillThenDraw',

}).clone({
    name: name('myphrase_clear'),
    startX: '62%',
    method: 'clear'

}).clone({
    name: name('myphrase_multiline'),

    text: 'Lorem ipsum har varit standard ðŸ˜€ Ã¤nda sedan 1500-talet, nÃ¤r-en-okÃ¤nd-boksÃ¤ttare-tog att antal ðŸ¤– bokstÃ¤ver och blandade dem fÃ¶r att gÃ¶ra ett ðŸŽ» provexemplar av en bok.',

    width: 120,
    justify: 'center',

    size: '12px',
    weight: 'normal',

    startX: '84%',
    method: 'fill',

    shadowOffsetX: 0,
    shadowOffsetY: 0,
    shadowBlur: 0,
});


// Change the fill and stroke styles on one of the phrase entitys, and any entity sharing that phrase's state
L.artefact[name('myphrase_fillAndDraw')].set({
    fillStyle: 'blue',
    strokeStyle: 'coral'
});


// #### User interaction
// Create the drag-and-drop zone
const current = makeDragZone({

    zone: canvas,
    endOn: ['up', 'leave'],
    exposeCurrentArtefact: true,
    preventTouchDefaultWhenDragging: true,
});


// #### Scene animation
// Function to display frames-per-second data, and other information relevant to the demo
const report = reportSpeed('#reportmessage', function () {
    const dragging = current();
    return `Currently dragging: ${(typeof dragging !== 'boolean' && dragging) ? dragging.artefact.name : 'nothing'}`;
});


// Create the Display cycle animation
makeRender({

    name: name('animation'),
    target: canvas,
    afterShow: report,
});


// #### Development and testing
console.log(L);

console.log('Performing tests ...');
killArtefact(canvas, name('myphrase_fill'), 4000);
killArtefact(canvas, name('myphrase_fillAndDraw'), 5000);
killArtefact(canvas, name('myphrase_multiline'), 6000);

</script>
</body>
</html>
